Here's your updated **README-style markdown**, with clear notes on what can be skipped and where to resume based on your setup:

---

# pyAFQ Setup & Execution Guide

This guide walks you through setting up a compatible Python environment and running [pyAFQ](https://yeatmanlab.github.io/pyAFQ/) on your BIDS-formatted diffusion dataset.

---

## üîÄ Can You Skip Steps?

* ‚úÖ If you already have `pyenv` installed **and** a virtual environment created:
  ‚Üí **Skip to [A6. Create and Activate the Virtual Environment](#a6-create-and-activate-the-virtual-environment)**.

* ‚úÖ If you already have `pyAFQ` installed in your virtual environment:
  ‚Üí **Skip to [C. Run pyAFQ](#c-run-pyafq)**.

---

## A. Set Up a Compatible Python Environment

> ‚ö†Ô∏è `pyAFQ` does **not** install cleanly with the latest Python versions. You must use **Python 3.10.12** in a virtual environment.

### A1. Ensure Access to the `/opt/homebrew` Folder

```bash
sudo chown -R tut34411 /opt/homebrew
chmod -R u+w /opt/homebrew
```

### A2. Install `pyenv`

```bash
brew update
brew install pyenv
```

Check that it's installed:

```bash
pyenv --version
```

### A3. Add `pyenv` to Your Shell Path

Paste the following into your terminal:

```bash
export PATH="$HOME/.pyenv/bin:$PATH"
eval "$(pyenv init --path)"
eval "$(pyenv virtualenv-init -)"
```

### A4. Install Python 3.10.12 Using `pyenv`

```bash
pyenv install 3.10.12
pyenv global 3.10.12
```

### A5. Configure Shell for `pyenv`

1. Open your `.bash_profile` file:

   ```bash
   nano ~/.bash_profile
   ```

2. Add this to the bottom:

   ```bash
   export PYENV_ROOT="$HOME/.pyenv"
   export PATH="$PYENV_ROOT/bin:$PATH"
   eval "$(pyenv init --path)"
   eval "$(pyenv init -)"
   eval "$(pyenv virtualenv-init -)"
   ```

3. Save and exit:

   * Press `Ctrl + O` to save, then `Enter`
   * Press `Ctrl + X` to exit

4. Apply changes:

   ```bash
   source ~/.bash_profile
   ```

---

### A6. Create and Activate the Virtual Environment

```bash
pyenv virtualenv 3.10.12 pyafq-env
pyenv activate pyafq-env
```

#All other times to reactivate, 

# first type in the terminal: 

export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init --path)"
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"

#2nd - reactivates: 
pyenv activate pyafq-env


---

## B. Prepare for Running pyAFQ

### B1. Install `pyAFQ` in the Virtual Environment

Make sure `libomp` is installed:

```bash
brew install libomp
```

Then install `pyAFQ`:

```bash
pip install pyAFQ
```

### B2. Create and Configure the `afq_config.toml` File

Create or verify `afq_config.toml`, e.g., at:

```text
/Volumes/DTI/DTI/Wave1/afq_config.toml
```

Update `bids_path` to match your dataset path.

Example `afq_config.toml`:

```toml
[files]
bids_path = "/media/tum99916/DTI/DTI/Wave1/pyAFQ"
brain_mask_definition = "ImageFile(suffix='mask', filters={'desc': 'brain'})"

[BIDS_PARAMS]
parallel_params = {n_jobs = -1, engine = "joblib", backend = "loky"}
```

> ‚ÑπÔ∏è The `[BIDS_PARAMS]` section enables parallel processing using all CPU cores (`n_jobs = -1`) via `joblib` with `loky` as backend.
> [See full config reference](https://yeatmanlab.github.io/pyAFQ/reference/config.html#)

---

### B3. Add `dataset_description.json`

You need this file in **two places**:

* `/Volumes/DTI/DTI/Wave1/pyAFQ/dataset_description.json`
* `/Volumes/DTI/DTI/Wave1/pyAFQ/derivatives/dataset_description.json`

They must be **identical**. Example content:

```json
{
  "Name": "R01_DTI",
  "BIDSVersion": "1.6",
  "DatasetType": "derivative",
  "GeneratedBy": [
    {
      "Name": "pyAFQ",
      "Version": "1.0.1"
    }
  ]
}
```

> ‚ö†Ô∏è **Do not modify** the contents of these JSON files.

---

## C. Run pyAFQ

Once your environment is active and config files are set, run:

```bash
pyAFQ /Volumes/DTI/DTI/Wave1/afq_config.toml
```

> ‚è≥ This may take **multiple days** depending on dataset size.

### Output

After completion, check:

* `derivatives/afq/`
* Key result: `tract_profiles.csv` ‚Äî contains participant tract profiles.

---

### ‚ö†Ô∏è Important: If Re-Running pyAFQ

Before re-running `pyAFQ`, you **must delete** the previous output:

```bash
rm -rf /path/to/derivatives/afq
```

Otherwise, it may not process correctly.

---

‚úÖ You‚Äôre now ready to run pyAFQ!

Let me know if you‚Äôd like this as a downloadable `.md` file.
